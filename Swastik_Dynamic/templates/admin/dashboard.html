{% extends "admin/base_admin.html" %}

{% block content %}
    <div class="dashboard-header">
        <div>
            <h2>Product Inventory</h2>
            <p class="subtitle">Manage your catalog, prices, and availability.</p>
        </div>
        <a href="{{ url_for('admin_add_product') }}" class="btn btn-primary">
            <i class="material-icons-round">add_circle</i> Add New Product
        </a>
    </div>

    <!-- Filters & Search -->
    <div class="controls-card">
        <div class="search-box">
            <i class="material-icons-round">search</i>
            <input type="text" id="adminSearch" placeholder="Search by name..." onkeyup="filterTable()">
        </div>
        <div class="filter-box">
            <i class="material-icons-round">filter_list</i>
            <select id="categoryFilter" onchange="filterTable()">
                <option value="all">All Categories</option>
                <option value="sofas">Sofas</option>
                <option value="beds">Beds</option>
                <option value="tables">Tables</option>
                <option value="chairs">Chairs</option>
                <option value="storage">Storage</option>
                <option value="tv-panels">TV Panels</option>
                <option value="kitchen">Kitchen</option>
            </select>
        </div>
    </div>

    <div class="table-container">
        <table id="productTable">
            <thead>
                <tr>
                    <th width="80">Image</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th width="120">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>
                        <div class="img-wrapper">
                            {% if product.image %}
                                <img src="{{ product.image }}" alt="">
                            {% else %}
                                <i class="material-icons-round">image_not_supported</i>
                            {% endif %}
                        </div>
                    </td>
                    <td class="fw-bold">{{ product.name }}</td>
                    <td><span class="badge badge-light">{{ product.category|capitalize }}</span></td>
                    <td class="fw-bold">{{ product.price }}</td>
                    <td>
                        <div class="status-tags">
                            {% if product.get('available', True) %}
                                <span class="badge badge-success">In Stock</span>
                            {% else %}
                                <span class="badge badge-danger">Unavailable</span>
                            {% endif %}

                            {% if product.bestseller %}
                                <span class="badge badge-warning"><i class="material-icons-round" style="font-size:12px;">star</i> Top</span>
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="{{ url_for('admin_edit_product', product_id=product.id) }}" class="icon-btn edit" title="Edit">
                                <i class="material-icons-round">edit</i>
                            </a>
                            <a href="{{ url_for('admin_delete_product', product_id=product.id) }}" class="icon-btn delete" title="Delete" onclick="return confirm('Delete this product permanently?');">
                                <i class="material-icons-round">delete_outline</i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if not products %}
            <div class="empty-state">
                <i class="material-icons-round">inventory_2</i>
                <p>No products found in your inventory.</p>
            </div>
        {% endif %}
    </div>

    <style>
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .dashboard-header h2 { margin: 0; font-size: 1.8rem; }
        .subtitle { margin: 5px 0 0; color: var(--text-light); }

        .controls-card { 
            background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; 
            display: flex; gap: 15px; box-shadow: var(--shadow); border: 1px solid var(--border);
            flex-wrap: wrap;
        }
        
        .search-box, .filter-box { position: relative; flex: 1; min-width: 250px; }
        .search-box i, .filter-box i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-light); }
        .search-box input, .filter-box select { padding-left: 40px; margin: 0; }

        .table-container { background: white; border-radius: 12px; box-shadow: var(--shadow); border: 1px solid var(--border); overflow: hidden; }
        .table-container { overflow-x: auto; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; text-align: left; padding: 15px 20px; font-weight: 600; color: var(--text-light); border-bottom: 2px solid var(--border); white-space: nowrap; }
        td { padding: 15px 20px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #fcfcfc; }

        .img-wrapper { width: 48px; height: 48px; border-radius: 8px; overflow: hidden; background: #f1f3f5; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); }
        .img-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .img-wrapper i { color: #ccc; }

        .fw-bold { font-weight: 600; color: var(--secondary); }
        
        .status-tags { display: flex; gap: 5px; flex-wrap: wrap; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; }
        .badge-light { background: #f1f3f5; color: #495057; border: 1px solid #e9ecef; }
        .badge-success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .badge-danger { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .badge-warning { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }

        .action-buttons { display: flex; gap: 8px; }
        .icon-btn { width: 34px; height: 34px; border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; text-decoration: none; }
        .icon-btn.edit { background: #e0f2fe; color: #0369a1; }
        .icon-btn.edit:hover { background: #bae6fd; }
        .icon-btn.delete { background: #fee2e2; color: #991b1b; }
        .icon-btn.delete:hover { background: #fecaca; }

        .empty-state { padding: 40px; text-align: center; color: var(--text-light); }
        .empty-state i { font-size: 48px; margin-bottom: 10px; opacity: 0.5; }

        @media (max-width: 600px) {
            .controls-card { flex-direction: column; }
            .search-box, .filter-box { width: 100%; }
        }
    </style>

    <script>
        function filterTable() {
            let input = document.getElementById("adminSearch").value.toUpperCase();
            let catFilter = document.getElementById("categoryFilter").value.toUpperCase();
            let table = document.getElementById("productTable");
            let tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
                let tdName = tr[i].getElementsByTagName("td")[1];
                let tdCat = tr[i].getElementsByTagName("td")[2];
                if (tdName && tdCat) {
                    let txtValue = tdName.textContent || tdName.innerText;
                    let catValue = tdCat.textContent || tdCat.innerText;
                    
                    let matchesSearch = txtValue.toUpperCase().indexOf(input) > -1;
                    let matchesCat = catFilter === "ALL" || catValue.toUpperCase().includes(catFilter);

                    tr[i].style.display = (matchesSearch && matchesCat) ? "" : "none";
                }
            }
        }
    </script>
{% endblock %}